\section{SPOJ -- Maximum Sum}

\begin{frame}[fragile]{Problema}

You are given a sequence $A[1], A[2], \ldots, A[N]$ ($0 \leq A[i] \leq 10^8$, $2 \leq N \leq 10^5$).
There are two types of operations and they are defined as follows:

\textbf{Update}:

This will be indicated in the input by a `\texttt{U}' followed by space and then two integers 
$i$ and $x$.

\textbf{U i x}, $1 \leq i \leq N$, and $x$, $0 \leq x \leq 10^8$.

This operation sets the value of $A[i]$ to $x$.

\textbf{Query}:

This will be indicated in the input by a `\texttt{Q}' followed by a single space and then two 
integers $x$ and $y$.

\textbf{Q x y}, $1 \leq x < y \leq N$.

You must find $i$ and $j$ such that $x \leq i, j \leq y$ and $i \neq j$, such that the sum 
$A[i]+A[j]$ is maximized. Print the sum $A[i]+A[j]$.

\end{frame}

\begin{frame}[fragile]{Entrada e saída}

\textbf{Input}

The first line of input consists of an integer $N$ representing the length of the sequence. Next 
line consists of $N$ space separated integers $A[i]$. Next line contains an integer 
$Q, Q \leq 10^5$, representing the number of operations. Next $Q$ lines contain the operations.

\textbf{Output}

Output the maximum sum mentioned above, in a separate line, for each Query.

\end{frame}

\begin{frame}[fragile]{Exemplo de entradas e saídas}

\begin{minipage}[t]{0.5\textwidth}
\textbf{Sample Input}
\begin{verbatim}
5
1 2 3 4 5
6
Q 2 4
Q 2 5
U 1 6
Q 1 5
U 1 7
Q 1 5
\end{verbatim}
\end{minipage}
\begin{minipage}[t]{0.45\textwidth}
\textbf{Sample Output}
\begin{verbatim}
7
9
11
12
\end{verbatim}
\end{minipage}
\end{frame}

\begin{frame}[fragile]{Solução}

    \begin{itemize}
        \item Um algoritmo \textit{naive}, que percorre o intervalo $[x, y]$ em busca destes
            valores tem complexidade $O(QN)$ no pior caso, o que leva ao TLE

        \item Para melhorar esta complexidade, observe primeiro que os índices $i, j$ que maximizam
            a soma $A[i] + A[j]$ correspondem aos dois maiores elementos no intervalo $[x, y]$

        \item Assim, pode-se utilizar uma árvore de segmentos para manter, para cada intervalo,
            os valores de seus dois maiores elementos

        \item Nas folhas, devem ser armazenados os pares $(A[i], 0)$

        \item Em cada nó, é preciso avaliar os pares armazenados nos filhos à esquerda e à direita,
            e escolher dentre eles os dois maiores

        \item Esta solução terá complexidade $O(Q\log N)$ no pior caso, de modo que a solução
            será aceita
    \end{itemize}

\end{frame}

\begin{frame}[fragile]{Solução AC com complexidade $O(Q\log N)$}
    \inputsnippet{cpp}{1}{21}{codes/KGSS.cpp}
\end{frame}

\begin{frame}[fragile]{Solução AC com complexidade $O(Q\log N)$}
    \inputsnippet{cpp}{22}{42}{codes/KGSS.cpp}
\end{frame}

\begin{frame}[fragile]{Solução AC com complexidade $O(Q\log N)$}
    \inputsnippet{cpp}{44}{64}{codes/KGSS.cpp}
\end{frame}

\begin{frame}[fragile]{Solução AC com complexidade $O(Q\log N)$}
    \inputsnippet{cpp}{66}{86}{codes/KGSS.cpp}
\end{frame}

\begin{frame}[fragile]{Solução AC com complexidade $O(Q\log N)$}
    \inputsnippet{cpp}{87}{107}{codes/KGSS.cpp}
\end{frame}
